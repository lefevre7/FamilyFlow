# AGENTS TODO — ADHD MOM (Family Flow)

Guardrails
- Android-first; keep KMP compiling with stubs for iOS/desktop.
- Mom admin only (no partner edit / no backend).
- Google Calendar remains the only external calendar import in this phase (no iCal import yet).
- Event people ownership must be added without Room schema migration.
- LLM: LiteRT-LM (Gemma3) with asset pack + `media.githubusercontent.com` download fallback.
- OCR: Tesseract4Android, `eng.traineddata` bundled in APK.
- If you ever need to use Clock.System.now(), use System.nanoTime() instead as this runs on an Android Phone and there is no Clock.System.now() on Android Phone
- Display name: ADHD MOM; keep applicationId/package unchanged.
- After every item: run `./gradlew :composeApp:test` and `./gradlew :composeApp:testDebugUnitTest`, and fix failures before moving on.
- For each item: search the codebase for related modules first; if anything is unclear, ask follow-up questions until high confidence (>95%) before implementing.

- [x] 1. Baseline mapping and guardrail setup. Map current navigation, data flow, and DI wiring; document where new screens, repositories, and storage should attach; add temporary stubs for iOS/desktop targets for any new Android-only features. After completion, run unit tests and fix failures. adhd_mom_baseline.md is in the /docs/ folder.
- [x] 2. Data model expansion. Add Person/Task/Routine/Project/Inbox models, Room entities, DAOs, and migrations; add repository interfaces and implementations; update mappers and use cases; seed default profiles (Mom, partner, 3 kids) in local data. After completion, run unit tests and fix failures.
- [x] 3. Schedule aggregation + filtering. Implement `ScheduleItem` composition (events + tasks), person filters, priority/energy ordering, and “Today Only” time windowing; add basic conflict detection and suggestion slots. After completion, run unit tests and fix failures.
- [x] 4. Navigation overhaul. Replace bottom nav with Today | Week | Plan | People | Settings; wire new navigation keys and routes; keep legacy calendar screens hidden. After completion, run unit tests and fix failures.
- [x] 5. Today (Survival Mode). Implement Morning/Afternoon/Evening grouped cards with “+N more,” Today-only toggle, quick actions (Start/Done/Snooze/Share), and sticky routines. After completion, run unit tests and fix failures.
- [x] 6. Week (Reality Check). Implement per-day columns, person color bars, “Only Mom required” and “Only Must” filters, and day bottom-sheet expansion. After completion, run unit tests and fix failures.
- [x] 7. Plan (Brain Dump + Month + Seasonal Projects). Add inbox list, processing actions, seasonal project cards, and month overview; integrate suggestion acceptance flow. After completion, run unit tests and fix failures.
- [x] 8. People screen + profile management. Provide profile list, avatar/color editing, and role labels; enforce Mom-admin-only editing rules; keep others view-only. After completion, run unit tests and fix failures.
- [x] 9. Quick-add + voice capture. Implement FAB with Task (default), Event, and Voice; add quick task modal with tags/energy/priority; add SpeechRecognizer flow for brain-dump capture. After completion, run unit tests and fix failures.
- [x] 10. OCR import pipeline. Add camera/gallery capture, Tesseract OCR, review list of candidate events, and per-item edit/accept; route OCR text through LLM structuring (strict JSON schema + validation). After completion, run unit tests and fix failures.
- [x] 11. LiteRT-LM integration. Port the StockSignal LiteRT-LM runtime and model management (asset pack + download fallback); add model download UI/flow; integrate GPU/CPU fallback and incompatibility handling; expose LLM service to OCR + brain dump processing. After completion, run unit tests and fix failures.
- [x] 12. Google Calendar import + sync. Add OAuth flow (client IDs from `local.properties`), selected calendar import, two-way sync, and background refresh (manual + 6h); add conflict resolution sheet with suggested actions. After completion, run unit tests and fix failures.
- [x] 13. Reminders, timers, and widgets. Implement prep/start notifications, optional travel-time buffer (location permission), visual timers, and widgets (Today snapshot + Quick-add). After completion, run unit tests and fix failures.
- [x] 14. Theme and branding. Retune Material3 Expressive to calm palette and reduced motion defaults; update typography sizes; rename display name to ADHD MOM; replace launcher icon. After completion, run unit tests and fix failures.
- [x] 15. Add/expand tests (penultimate step). Add unit tests for schedule aggregation, suggestion engine, OCR parsing, LLM JSON validation, and quick-add; add Robolectric tests for Today grouping and quick-add flow; run all tests and fix failures.
- [x] 16. Cleanup and stabilization. Remove dead code, update docs/README, resolve warnings where feasible, ensure KMP stubs are safe, and re-run all tests. After completion, run unit tests and fix failures.

- [x] 17. Spec conformance re-audit for items 1-16. Re-verify each completed item against the original Family Flow spec (ADHD behavior, UX friction, and data semantics), produce a gap matrix in `docs/` with file-level ownership, and map every open gap to items 18+ below before coding. Completed in `docs/adhd_mom_spec_conformance_matrix.md`.
- [x] 18. Event people ownership + Who's Affected (no DB migration). Added `affectedPersonIds` at domain level, sidecar persistence via `IEventPeopleRepository` (DataStore on Android + KMP stubs), create/sync/conflict paths wired to preserve mappings, and "Who's affected" labels shown on Today/Week/Plan/detail cards.
- [x] 19. Persistent shared lens architecture. Added shared `Family | Mom | Person` lens model/state (`LensStateHolder`) backed by persistent lens preferences (Android DataStore + desktop/iOS stubs), wired Today/Week/Plan to the shared state, and introduced reusable avatar-aware mini-header component (`FamilyLensMiniHeader`).
- [x] 20. Today Survival action completion. Wired `Done`, `Snooze`, and `Share` actions in Today cards (task completion persisted, task/event snooze handling, item share), enforced strict Today Only behavior (`active now` OR `starts within +/-30 minutes`), preserved sticky routines, and added shareable Today snapshot flow via Android sharesheet (`text/plain`, SMS/WhatsApp compatible).
- [x] 21. Week + Plan lens parity. Week and Plan now respect the shared lens state for filtering; who-is-affected labels remain consistent on suggestion/task/event cards; Week keeps stable independent toggles for both "Only Mom required" and "Only Must" while still supporting persistent lens selection.
- [x] 22. Suggestion engine v2 (conservative). Upgrade scoring to include conflict penalty, energy match bonus, due-date proximity, and routine anchor preference; enforce configurable daily load cap (default 5 Must/Should); keep two options only; implement `Accept slot A | Accept slot B | Not now` with undo toast.
- [x] 23. Plan brain-dump inline capture. Add inline text capture in Plan/Brain Dump (capture-first path) while keeping Quick Add Task as direct flexible task creation; keep processing flow low-friction with clear status transitions (`NEW -> PROCESSED/ARCHIVED`).
- [x] 24. FAB interaction polish. Keep existing Quick Add sheet, but add a true long-press reveal affordance for Task/Event/Voice shortcuts and preserve tap-to-quick-task default; ensure accessibility labels and touch targets are large and consistent.
- [x] 25. OCR acceptance enhancements. Add recurring-pattern detection with explicit prompt (`Add as recurring?`), person assignment during review, and default `school` category mapping for accepted school schedule items; require explicit accept/edit/discard per candidate.
- [x] 26. Import classification layer. Add keyword-based classification for imported items (`school`, `practice`, `appointment`) with editable category chips; keep translator-style human card output and conservative behavior (no silent reschedule).
- [x] 27. Accessibility + calm defaults. Set reduced motion ON by default; add high-contrast toggle and text-size scale controls in Settings; verify screen-reader order/content descriptions for core Today/Week/Plan actions and filters.
- [x] 28. Onboarding v2 (3 screens max, skippable). Expand onboarding to guided setup with quick value path: Mom/default profiles, kids presets, optional Google import, and quick demo of FAB + Today Only + mode switching; keep every step skippable and end on `Open Today`.
- [x] 29. Month/Year planning + preschool templates. Extend planning with year-level alert strip/highlights and strengthen seasonal project surfacing; add preschool routine templates (morning, bedtime, pickup checklist) with one-tap insertion into routines/tasks.
- [x] 30. Sync conflict UX surfacing. Keep conflict resolution in Settings, and add contextual "Conflicts need review" entry points from Today/Week when pending sync conflicts exist.
- [x] 31. Warning reduction and technical hardening. Reduce high-signal warnings (deprecated datetime APIs, always-true conditions, opt-in noise) where low-risk; avoid broad refactors and preserve behavior. Help the user sign in with Google Calendar OAuth which includes creating an android debug key.
- [x] 32. Add/expand tests for new scope (new penultimate step). Added unit tests for event-people sidecar mapping, lens persistence, today action handlers (`UpdateTaskUseCase`), suggestion scoring/cap, OCR recurring + classification, onboarding decisions, and accessibility settings; added Robolectric tests for mini-header persistence, share snapshot intents, quick-action flows, and Plan inline capture; ran both test commands and fixed failures.
- [x] 33. Final cleanup and stabilization (new final step). Refreshed README/docs with implemented behaviors and non-goals (Google-only import, no Room migration for event people), re-verified KMP stubs for iOS/desktop sidecar + lens preferences, ran `./gradlew :composeApp:test`, `./gradlew :composeApp:testDebugUnitTest`, and `./gradlew :composeApp:assembleDebug`. Emulator smoke checks were run via ADB for onboarding, Today/share, Plan OCR entry (`Scan schedule`), and Settings entry; FAB-driven quick-add and in-screen sync-conflict detail checks remain best validated manually because ADB tap/gesture automation was not reliable for those controls in this environment.
